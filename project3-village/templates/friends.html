{% extends "base.html" %}

{% block content %}
<div class="friends-container">
    
    <div class="search-section">
        <h2>Find Villagers</h2>
        <form action="/friends" method="post" class="search-form">
            <input type="text" name="search_query" placeholder="Search username" value="{{ search_query }}" required>
            <button type="submit">Search</button>
        </form>

        {% if search_results %}
            <ul class="friends-list-view">
                {% for user in search_results %}
                <li class="friend-list-item">
                    <span class="friend-name">{{ user.username }}</span>
                    <form action="{{ url_for('send_request', user_id=user._id) }}" method="post" style="margin:0;">
                        <button type="submit" class="add-btn">Send Request</button>
                    </form>
                </li>
                {% endfor %}
            </ul>
        {% elif search_query %}
            <p style="color: #e4ac50;">No villagers found matching "{{ search_query }}".</p>
        {% endif %}
    </div>

    {% if friend_requests %}
    <div class="requests-section">
        <h2>Friend Requests</h2>
        <ul class="friends-list-view">
            {% for req in friend_requests %}
            <li class="friend-list-item request-item">
                <span class="friend-name">{{ req.username }}</span>
                <div class="request-actions">
                    <form action="{{ url_for('accept_request', user_id=req._id) }}" method="post">
                        <button type="submit" class="accept-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM8 9C9.10457 9 10 8.10457 10 7C10 5.89543 9.10457 5 8 5C6.89543 5 6 5.89543 6 7C6 8.10457 6.89543 9 8 9Z"
                                    fill="currentColor" />
                                <path
                                    d="M11 14C11.5523 14 12 14.4477 12 15V21H14V15C14 13.3431 12.6569 12 11 12H5C3.34315 12 2 13.3431 2 15V21H4V15C4 14.4477 4.44772 14 5 14H11Z"
                                    fill="currentColor" />
                                <path d="M18 7H20V9H22V11H20V13H18V11H16V9H18V7Z" fill="currentColor" />
                            </svg>
                        </button>
                    </form>
                    <form action="{{ url_for('decline_request', user_id=req._id) }}" method="post">
                        <button type="submit" class="decline-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM8 9C9.10457 9 10 8.10457 10 7C10 5.89543 9.10457 5 8 5C6.89543 5 6 5.89543 6 7C6 8.10457 6.89543 9 8 9Z"
                                    fill="currentColor" />
                                <path
                                    d="M11 14C11.5523 14 12 14.4477 12 15V21H14V15C14 13.3431 12.6569 12 11 12H5C3.34315 12 2 13.3431 2 15V21H4V15C4 14.4477 4.44772 14 5 14H11Z"
                                    fill="currentColor" />
                                <path d="M22 9H16V11H22V9Z" fill="currentColor" />
                            </svg>
                        </button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <h2>My Friends</h2>
    <div class="friends-list-container">
        {% if friends %}
            <ul class="friends-list-view">
                {% for friend in friends %}
                <li class="friend-list-item">
                    <span class="friend-name">{{ friend.username }}</span>
                    <form action="{{ url_for('remove_friend', user_id=friend._id) }}" method="post" style="margin:0;">
                        <button type="submit" class="remove-btn" aria-label="Remove Friend">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM8 9C9.10457 9 10 8.10457 10 7C10 5.89543 9.10457 5 8 5C6.89543 5 6 5.89543 6 7C6 8.10457 6.89543 9 8 9Z"
                                    fill="currentColor" />
                                <path
                                    d="M11 14C11.5523 14 12 14.4477 12 15V21H14V15C14 13.3431 12.6569 12 11 12H5C3.34315 12 2 13.3431 2 15V21H4V15C4 14.4477 4.44772 14 5 14H11Z"
                                    fill="currentColor" />
                                <path d="M22 9H16V11H22V9Z" fill="currentColor" />
                            </svg>
                        </button>
                    </form>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="color: #67d3d1;">You haven't made any friends yet :(</p>
        {% endif %}
    </div>
</div>
{% endblock %}
